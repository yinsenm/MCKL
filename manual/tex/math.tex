% ============================================================================
%  MCKL/manual/tex/math.tex
% ----------------------------------------------------------------------------
%  MCKL: Monte Carlo Kernel Library
% ----------------------------------------------------------------------------
%  Copyright (c) 2013-2016, Yan Zhou
%  All rights reserved.
%
%  Redistribution and use in source and binary forms, with or without
%  modification, are permitted provided that the following conditions are met:
%
%    Redistributions of source code must retain the above copyright notice,
%    this list of conditions and the following disclaimer.
%
%    Redistributions in binary form must reproduce the above copyright notice,
%    this list of conditions and the following disclaimer in the documentation
%    and/or other materials provided with the distribution.
%
%  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
%  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
%  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
%  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
%  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
%  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
%  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
%  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
%  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
%  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
%  POSSIBILITY OF SUCH DAMAGE.
% ============================================================================

\chapter{Mathematical functions}
\label{chap:Mathemtical functions}

\section{Constants}
\label{sec:Constants}

\mckl defines some mathematical constants in the form of constant expression
functions. For example, to get the value of $\pi$ with a desired precision, one
can use the following,
\begin{verbatim}
constexpr float pi_f = const_pi<float>();
constexpr double pi_d = const_pi<double>();
constexpr long double pi_l = const_pi<long double>();
\end{verbatim}
The compiler evaluates these values at compile-time and thus there is no
performance difference from hard-coding the constants in the program, while the
readability is improved. All defined constants are listed in
table~\ref{tab:Mathematical constants}.

\section{Vectorized functions}
\label{sec:Vectorized functions}

\mckl provides a set of vectorized elementary mathematical functions. For
example, to perform additions of two vectors,
\begin{verbatim}
size_t n = 1000;
Vector<double> a(n), b(n), y(n);
// Fill vectors a and b
add(n, a.data(), b.data(), y.data());
\end{verbatim}
This is equivalent to,
\begin{verbatim}
for (size_t i = 0; i != n; ++i)
    y[i] = a[i] + b[i];
\end{verbatim}
The functions defined are listed in tables~\ref{tab:Arithmetic functions}
to~\ref{tab:Rounding functions}. For each function, the first parameter is
always the length of the vector, and the last is a pointer to the output vector
(except for |sincos| and |modf|, which have two output parameters). For all
functions, the output parameters are always vectors. If there are more than one
input parameters, then some of them, but not all, can be scalars. For example,
for the function call |fma(n, a, b, c, y)| in table~\ref{tab:Arithmetic
functions}, the input parameters are |a|, |b|, and |c|. Some of them, not all,
can be scalars instead of pointers to vectors. The output parameter |y| has to
be a pointer to a vector. Therefore, there are seven versions of this function
for each type of the parameters.

The input of these functions  can be either real numbers (|double|, etc.), or
complex numbers (|std::complex<double>|, etc.), or both. The supported data
types are also listed in the tables. In most cases, output data type is the
same as the input. There are a few exceptions. The |abs| and |arg| functions
always have real numbers as output. The |cis| function takes real numbers as
input and complex numbers as output. Note that, mixed precision is not allowed.
For example,
\begin{verbatim}
Vector<double> a(n);
Vector<double> b(n);
Vector<double> y(n);
fma(n, a.data(), b.data(), 2, y.data());
\end{verbatim}
causes compile-time error because the fourth argument is an integer while the
others are floating points. The correct call shall be,
\begin{verbatim}
fma(n, a.data(), b.data(), 2.0, y.data());
\end{verbatim}
The same principle applies to mixed types functions (|abs|, |arg| and |cis|).
That is, a |double| input can only be paired with a |std::complex<double>|
output for |cis| and \emph{vice versa} for |abs| and |arg|.

Without any third-party libraries, these functions do not provide performance
advantage compared to simple loops. When \mkl is available, some functions can
have substantial performance improvement when all input arguments are vectors
of types |float| or |double|, or their complex counterparts. The performance of
vectorized random number generating introduced later in
section~\ref{sec:Vectorized random number generating} heavily depends on these
functions.

\begin{table}
  \begin{tabularx}{\textwidth}{p{1.25in}Lp{1.25in}L}
    \toprule
    Function & Value & Function & Value \\
    \midrule
    \texttt{const\_inf}            & $\infty$        &
    \texttt{const\_nan}            & NaN             \\
    \texttt{const\_zero}           & $0$             &
    \texttt{const\_one}            & $1$             \\
    \texttt{const\_pi}             & $\pi$           &
    \texttt{const\_pi\_2}          & $2\pi$          \\
    \texttt{const\_pi\_inv}        & $1/\pi$         &
    \texttt{const\_pi\_sqr}        & $\pi^2$         \\
    \texttt{const\_pi\_by2}        & $\pi/2$         &
    \texttt{const\_pi\_by3}        & $\pi/3$         \\
    \texttt{const\_pi\_by4}        & $\pi/4$         &
    \texttt{const\_pi\_by6}        & $\pi/6$         \\
    \texttt{const\_pi\_2by3}       & $2\pi/3$        &
    \texttt{const\_pi\_3by4}       & $3\pi/4$        \\
    \texttt{const\_pi\_4by3}       & $4\pi/3$        &
    \texttt{const\_sqrt\_pi}       & $\sqrt{\pi}$    \\
    \texttt{const\_sqrt\_pi\_2}    & $\sqrt{2\pi}$   &
    \texttt{const\_sqrt\_pi\_inv}  & $\sqrt{1/\pi}$  \\
    \texttt{const\_sqrt\_pi\_by2}  & $\sqrt{\pi/2}$  &
    \texttt{const\_sqrt\_pi\_by3}  & $\sqrt{\pi/3}$  \\
    \texttt{const\_sqrt\_pi\_by4}  & $\sqrt{\pi/4}$  &
    \texttt{const\_sqrt\_pi\_by6}  & $\sqrt{\pi/6}$  \\
    \texttt{const\_sqrt\_pi\_2by3} & $\sqrt{2\pi/3}$ &
    \texttt{const\_sqrt\_pi\_3by4} & $\sqrt{3\pi/4}$ \\
    \texttt{const\_sqrt\_pi\_4by3} & $\sqrt{4\pi/3}$ &
    \texttt{const\_ln\_pi}         & $\ln{\pi}$      \\
    \texttt{const\_ln\_pi\_2}      & $\ln{2\pi}$     &
    \texttt{const\_ln\_pi\_inv}    & $\ln{1/\pi}$    \\
    \texttt{const\_ln\_pi\_by2}    & $\ln{\pi/2}$    &
    \texttt{const\_ln\_pi\_by3}    & $\ln{\pi/3}$    \\
    \texttt{const\_ln\_pi\_by4}    & $\ln{\pi/4}$    &
    \texttt{const\_ln\_pi\_by6}    & $\ln{\pi/6}$    \\
    \texttt{const\_ln\_pi\_2by3}   & $\ln{2\pi/3}$   &
    \texttt{const\_ln\_pi\_3by4}   & $\ln{3\pi/4}$   \\
    \texttt{const\_ln\_pi\_4by3}   & $\ln{4\pi/3}$   &
    \texttt{const\_e}              & $\EE$           \\
    \texttt{const\_e\_inv}         & $1/\EE$         &
    \texttt{const\_sqrt\_e}        & $\sqrt{\EE}$    \\
    \texttt{const\_sqrt\_e\_inv}   & $\sqrt{1/\EE}$  &
    \texttt{const\_sqrt\_2}        & $\sqrt{2}$      \\
    \texttt{const\_sqrt\_3}        & $\sqrt{3}$      &
    \texttt{const\_sqrt\_5}        & $\sqrt{5}$      \\
    \texttt{const\_sqrt\_10}       & $\sqrt{10}$     &
    \texttt{const\_sqrt\_1by2}     & $\sqrt{1/2}$    \\
    \texttt{const\_sqrt\_1by3}     & $\sqrt{1/3}$    &
    \texttt{const\_sqrt\_1by5}     & $\sqrt{1/5}$    \\
    \texttt{const\_sqrt\_1by10}    & $\sqrt{1/10}$   &
    \texttt{const\_ln\_2}          & $\ln{2}$        \\
    \texttt{const\_ln\_3}          & $\ln{3}$        &
    \texttt{const\_ln\_5}          & $\ln{5}$        \\
    \texttt{const\_ln\_10}         & $\ln{10}$       &
    \texttt{const\_ln\_inv\_2}     & $1/\ln{2}$      \\
    \texttt{const\_ln\_inv\_3}     & $1/\ln{3}$      &
    \texttt{const\_ln\_inv\_5}     & $1/\ln{5}$      \\
    \texttt{const\_ln\_inv\_10}    & $1/\ln{10}$     &
    \texttt{const\_ln\_ln\_2}      & $\ln\ln{2}$     \\
    \bottomrule
  \end{tabularx}
  \caption{Mathematical constants}
  \label{tab:Mathematical constants}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{add(n, a, b, y)}       & $y = a + b$           & Real, Complex \\
    \texttt{sub(n, a, b, y)}       & $y = a - b$           & Real, Complex \\
    \texttt{sqr(n, a, y)}          & $y = a^2$             & Real          \\
    \texttt{mul(n, a, b, y)}       & $y = ab$              & Real, Complex \\
    \texttt{mulbyconj(n, a, b, y)} & $y = a\bar{b}$        & Complex       \\
    \texttt{conj(n, a, y)}         & $y = \bar{a}$         & Complex       \\
    \texttt{abs(n, a, y)}          & $y = \Abs{a}$         & Real, Complex \\
    \texttt{arg(n, a, y)}          & $y = \mathrm{arg}(a)$ & Complex       \\
    \texttt{fma(n, a, b, c, y)}    & $y = ab + c$          & Real, Complex \\
    \bottomrule
  \end{tabularx}
  \caption{Arithmetic functions}
  \label{tab:Arithmetic functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{inv(n, a, y)}      & $y = 1 / a$            & Real          \\
    \texttt{div(n, a, b, y)}   & $y = a / b$            & Real, Complex \\
    \texttt{sqrt(n, a, y)}     & $y = \sqrt{a}$         & Real, Complex \\
    \texttt{invsqrt(n, a, y)}  & $y = 1 / \sqrt{a}$     & Real          \\
    \texttt{cbrt(n, a, y)}     & $y = \sqrt[3]{a}$      & Real          \\
    \texttt{invcbrt(n, a, y)}  & $y = 1 / \sqrt[3]{a}$  & Real          \\
    \texttt{pow2o3(n, a, y)}   & $y = a^{2/3}$          & Real          \\
    \texttt{pow3o2(n, a, y)}   & $y = a^{3/2}$          & Real          \\
    \texttt{pow(n, a, b, y)}   & $y = a^b$              & Real, Complex \\
    \texttt{hypot(n, a, b, y)} & $y = \sqrt{a^2 + b^2}$ & Real          \\
    \bottomrule
  \end{tabularx}
  \caption{Power and root functions}
  \label{tab:Power and root functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{exp(n, a, y)}   & $y = \EE^a$       & Real, Complex \\
    \texttt{exp2(n, a, y)}  & $y = 2^a$         & Real          \\
    \texttt{expm1(n, a, y)} & $y = \EE^a - 1$   & Real          \\
    \texttt{log(n, a, y)}   & $y = \ln a$       & Real, Complex \\
    \texttt{log2(n, a, y)}  & $y = \log_2 a$    & Real          \\
    \texttt{log10(n, a, y)} & $y = \log_{10} a$ & Real, Complex \\
    \texttt{log1p(n, a, y)} & $y = \ln(a + 1)$  & Real          \\
    \bottomrule
  \end{tabularx}
  \caption{Exponential and logarithm functions}
  \label{tab:Exponential and logarithm functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{cos(n, a, y)}       & $y = \cos(a)$        & Real, Complex \\
    \texttt{sin(n, a, y)}       & $y = \sin(a)$        & Real, Complex \\
    \texttt{sincos(n, a, y, z)} & $y = \sin(a)$, $z = \cos(a)$ & Real  \\
    \texttt{cis(n, a, y)}       & $y = \cos(a) + i\sin(a)$   & Complex \\
    \texttt{tan(n, a, y)}       & $y = \tan(a)$        & Real, Complex \\
    \texttt{acos(n, a, y)}      & $y = \arccos(a)$     & Real, Complex \\
    \texttt{asin(n, a, y)}      & $y = \arcsin(a)$     & Real, Complex \\
    \texttt{atan(n, a, y)}      & $y = \arctan(a)$     & Real, Complex \\
    \texttt{atan2(n, a, y)}     & $y = \arctan(a / b)$ & Real          \\
    \bottomrule
  \end{tabularx}
  \caption{Trigonometric functions}
  \label{tab:Trigonometric functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{cosh(n, a, y)}  & $y = \cosh(a)$             & Real, Complex \\
    \texttt{sinh(n, a, y)}  & $y = \sinh(a)$             & Real, Complex \\
    \texttt{tanh(n, a, y)}  & $y = \tanh(a)$             & Real, Complex \\
    \texttt{acosh(n, a, y)} & $y = \mathrm{arc}\cosh(a)$ & Real, Complex \\
    \texttt{asinh(n, a, y)} & $y = \mathrm{arc}\sinh(a)$ & Real, Complex \\
    \texttt{atanh(n, a, y)} & $y = \mathrm{arc}\tanh(a)$ & Real, Complex \\
    \bottomrule
  \end{tabularx}
  \caption{Hyperbolic functions}
  \label{tab:Hyperbolic functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{erf(n, a, y)}     & $y = \mathrm{erf}(a)$  & Real \\
    \texttt{erfc(n, a, y)}    & $y = \mathrm{erfc}(a)$ & Real \\
    \texttt{cdfnorm(n, a, y)} & $y = (1 + \mathrm{erf}(a / \sqrt{2})) / 2$
    & Real \\
    \texttt{lgamma(n, a, y)}  & $y = \ln\Gamma(a)$     & Real \\
    \texttt{tgamma(n, a, y)}  & $y = \Gamma(a)$        & Real \\
    \bottomrule
  \end{tabularx}
  \caption{Special functions}
  \label{tab:Special functions}
\end{table}

\begin{table}
  \begin{tabularx}{\textwidth}{LLL}
    \toprule
    Function & Operation & Input data type \\
    \midrule
    \texttt{floor(n, a, y)} & $y = \Floor{a}$                       & Real \\
    \texttt{ceil(n, a, y)}  & $y = \Ceil{a}$                        & Real \\
    \texttt{trunc(n, a, y)} & $y = \mathrm{sgn}(a)\Floor{\Abs{a}}$  & Real \\
    \texttt{round(n, a, y)} & $y = \text{nearest integer of }a$     & Real \\
    \texttt{nearbyint(n, a, y)} & $y = \text{nearest integer of }a$ & Real \\
    \texttt{rint(n, a, y)}  & $y = \text{nearest integer of }a$     & Real \\
    \texttt{modf(n, a, y, z)} &
    $y = \mathrm{sign}(a)\Floor{\Abs{a}}$, $z = a - y$ & Real \\
    \bottomrule
  \end{tabularx}
  \caption{Rounding functions}
  \label{tab:Rounding functions}
\end{table}

\clearpage
